!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).mql=e()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,r,n,o,a,i){try{var s=t[a](i),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function r(t){return function(){var r=this,n=arguments;return new Promise(function(o,a){var i=t.apply(r,n);function s(t){e(i,o,a,s,u,"next",t)}function u(t){e(i,o,a,s,u,"throw",t)}s(void 0)})}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),n.forEach(function(e){a(t,e,r[e])})}return t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e,r){return(h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&c(o,r.prototype),o}).apply(null,arguments)}function f(t){var e="function"==typeof Map?new Map:void 0;return(f=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return h(t,arguments,u(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,t)})(t)}function l(t,e){if(null==t)return{};var r,n,o=function(t,e){if(null==t)return{};var r,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)>=0||(o[r]=t[r]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}function p(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function m(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var v="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var d,b=(function(e){!function(r){var n,o=Object.prototype,a=o.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag",h=r.regeneratorRuntime;if(h)e.exports=h;else{(h=r.regeneratorRuntime=e.exports).wrap=w;var f="suspendedStart",l="suspendedYield",p="executing",y="completed",m={},v={};v[s]=function(){return this};var d=Object.getPrototypeOf,b=d&&d(d(C([])));b&&b!==o&&a.call(b,s)&&(v=b);var g=_.prototype=j.prototype=Object.create(v);O.prototype=g.constructor=_,_.constructor=O,_[c]=O.displayName="GeneratorFunction",h.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===O||"GeneratorFunction"===(e.displayName||e.name))},h.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,c in t||(t[c]="GeneratorFunction")),t.prototype=Object.create(g),t},h.awrap=function(t){return{__await:t}},E(k.prototype),k.prototype[u]=function(){return this},h.AsyncIterator=k,h.async=function(t,e,r,n){var o=new k(w(t,e,r,n));return h.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(g),g[c]="Generator",g[s]=function(){return this},g.toString=function(){return"[object Generator]"},h.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},h.values=C,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,o){return s.type="throw",s.arg=t,e.next=r,o&&(e.method="next",e.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),c=a.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:C(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=n),m}}}function w(t,e,r,n){var o=e&&e.prototype instanceof j?e:j,a=Object.create(o.prototype),i=new L(n||[]);return a._invoke=function(t,e,r){var n=f;return function(o,a){if(n===p)throw new Error("Generator is already running");if(n===y){if("throw"===o)throw a;return P()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=R(i,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var u=x(t,e,r);if("normal"===u.type){if(n=r.done?y:l,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=y,r.method="throw",r.arg=u.arg)}}}(t,r,i),a}function x(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function j(){}function O(){}function _(){}function E(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function k(e){var r;this._invoke=function(n,o){function i(){return new Promise(function(r,i){!function r(n,o,i,s){var u=x(e[n],e,o);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"===t(h)&&a.call(h,"__await")?Promise.resolve(h.__await).then(function(t){r("next",t,i,s)},function(t){r("throw",t,i,s)}):Promise.resolve(h).then(function(t){c.value=t,i(c)},function(t){return r("throw",t,i,s)})}s(u.arg)}(n,o,r,i)})}return r=r?r.then(i,i):i()}}function R(t,e){var r=t.iterator[e.method];if(r===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=n,R(t,e),"throw"===e.method))return m;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var o=x(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,m;var a=o.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,m):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function C(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(a.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=n,e.done=!0,e};return o.next=o}}return{next:P}}function P(){return{value:n,done:!0}}}(function(){return this||"object"===("undefined"==typeof self?"undefined":t(self))&&self}()||Function("return this")())}(d={exports:{}},d.exports),d.exports),g=function(){return this||"object"===("undefined"==typeof self?"undefined":t(self))&&self}()||Function("return this")(),w=g.regeneratorRuntime&&Object.getOwnPropertyNames(g).indexOf("regeneratorRuntime")>=0,x=w&&g.regeneratorRuntime;g.regeneratorRuntime=void 0;var j=b;if(w)g.regeneratorRuntime=x;else try{delete g.regeneratorRuntime}catch(t){g.regeneratorRuntime=void 0}var O=j;var _=2147483647,E=36,k=1,R=26,A=38,S=700,L=72,C=128,P="-",U=/[^\x20-\x7E]/,T=/[\x2E\u3002\uFF0E\uFF61]/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},q=E-k,N=Math.floor,F=String.fromCharCode;function D(t){throw new RangeError(I[t])}function H(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function G(t,e,r){var n=0;for(t=r?N(t/S):t>>1,t+=N(t/e);t>q*R>>1;n+=E)t=N(t/q);return N(n+(q+1)*t/(t+A))}function M(t){return function(t,e){var r=t.split("@"),n="";r.length>1&&(n=r[0]+"@",t=r[1]);var o=function(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}((t=t.replace(T,".")).split("."),e).join(".");return n+o}(t,function(t){return U.test(t)?"xn--"+function(t){var e,r,n,o,a,i,s,u,c,h,f,l,p,y,m,v=[];for(l=(t=function(t){for(var e,r,n=[],o=0,a=t.length;o<a;)(e=t.charCodeAt(o++))>=55296&&e<=56319&&o<a?56320==(64512&(r=t.charCodeAt(o++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),o--):n.push(e);return n}(t)).length,e=C,r=0,a=L,i=0;i<l;++i)(f=t[i])<128&&v.push(F(f));for(n=o=v.length,o&&v.push(P);n<l;){for(s=_,i=0;i<l;++i)(f=t[i])>=e&&f<s&&(s=f);for(s-e>N((_-r)/(p=n+1))&&D("overflow"),r+=(s-e)*p,e=s,i=0;i<l;++i)if((f=t[i])<e&&++r>_&&D("overflow"),f==e){for(u=r,c=E;!(u<(h=c<=a?k:c>=a+R?R:c-a));c+=E)m=u-h,y=E-h,v.push(F(H(h+m%y,0))),u=N(m/y);v.push(F(H(u,0))),a=G(r,p,n==o),r=0,++n}++r,++e}return v.join("")}(t):t})}global.setTimeout,global.clearTimeout;var z=global.performance||{};z.now||z.mozNow||z.msNow||z.oNow||z.webkitNow;function $(t){return null===t}function B(t){return"string"==typeof t}function K(e){return"object"===t(e)&&null!==e}function W(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var Y=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function Z(e){switch(t(e)){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function J(t,e){if(t.map)return t.map(e);for(var r=[],n=0;n<t.length;n++)r.push(e(t[n],n));return r}var Q=Object.keys||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return e};function V(t,e,r,n){e=e||"&",r=r||"=";var o={};if("string"!=typeof t||0===t.length)return o;var a=/\+/g;t=t.split(e);var i=1e3;n&&"number"==typeof n.maxKeys&&(i=n.maxKeys);var s=t.length;i>0&&s>i&&(s=i);for(var u=0;u<s;++u){var c,h,f,l,p=t[u].replace(a,"%20"),y=p.indexOf(r);y>=0?(c=p.substr(0,y),h=p.substr(y+1)):(c=p,h=""),f=decodeURIComponent(c),l=decodeURIComponent(h),W(o,f)?Y(o[f])?o[f].push(l):o[f]=[o[f],l]:o[f]=l}return o}var X={parse:yt,resolve:function(t,e){return yt(t,!1,!0).resolve(e)},resolveObject:function(t,e){return t?yt(t,!1,!0).resolveObject(e):e},format:function(t){B(t)&&(t=mt({},t));return vt(t)},Url:tt};function tt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var et=/^([a-z0-9.+-]+:)/i,rt=/:[0-9]*$/,nt=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,ot=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),at=["'"].concat(ot),it=["%","/","?",";","#"].concat(at),st=["/","?","#"],ut=255,ct=/^[+a-z0-9A-Z_-]{0,63}$/,ht=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,ft={javascript:!0,"javascript:":!0},lt={javascript:!0,"javascript:":!0},pt={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function yt(t,e,r){if(t&&K(t)&&t instanceof tt)return t;var n=new tt;return n.parse(t,e,r),n}function mt(e,r,n,o){if(!B(r))throw new TypeError("Parameter 'url' must be a string, not "+t(r));var a=r.indexOf("?"),i=-1!==a&&a<r.indexOf("#")?"?":"#",s=r.split(i);s[0]=s[0].replace(/\\/g,"/");var u=r=s.join(i);if(u=u.trim(),!o&&1===r.split("#").length){var c=nt.exec(u);if(c)return e.path=u,e.href=u,e.pathname=c[1],c[2]?(e.search=c[2],e.query=n?V(e.search.substr(1)):e.search.substr(1)):n&&(e.search="",e.query={}),e}var h,f,l,p,y=et.exec(u);if(y){var m=(y=y[0]).toLowerCase();e.protocol=m,u=u.substr(y.length)}if(o||y||u.match(/^\/\/[^@\/]+@[^@\/]+/)){var v="//"===u.substr(0,2);!v||y&&lt[y]||(u=u.substr(2),e.slashes=!0)}if(!lt[y]&&(v||y&&!pt[y])){var d,b,g=-1;for(h=0;h<st.length;h++)-1!==(f=u.indexOf(st[h]))&&(-1===g||f<g)&&(g=f);for(-1!==(b=-1===g?u.lastIndexOf("@"):u.lastIndexOf("@",g))&&(d=u.slice(0,b),u=u.slice(b+1),e.auth=decodeURIComponent(d)),g=-1,h=0;h<it.length;h++)-1!==(f=u.indexOf(it[h]))&&(-1===g||f<g)&&(g=f);-1===g&&(g=u.length),e.host=u.slice(0,g),u=u.slice(g),dt(e),e.hostname=e.hostname||"";var w="["===e.hostname[0]&&"]"===e.hostname[e.hostname.length-1];if(!w){var x=e.hostname.split(/\./);for(h=0,l=x.length;h<l;h++){var j=x[h];if(j&&!j.match(ct)){for(var O="",_=0,E=j.length;_<E;_++)j.charCodeAt(_)>127?O+="x":O+=j[_];if(!O.match(ct)){var k=x.slice(0,h),R=x.slice(h+1),A=j.match(ht);A&&(k.push(A[1]),R.unshift(A[2])),R.length&&(u="/"+R.join(".")+u),e.hostname=k.join(".");break}}}}e.hostname.length>ut?e.hostname="":e.hostname=e.hostname.toLowerCase(),w||(e.hostname=M(e.hostname)),p=e.port?":"+e.port:"";var S=e.hostname||"";e.host=S+p,e.href+=e.host,w&&(e.hostname=e.hostname.substr(1,e.hostname.length-2),"/"!==u[0]&&(u="/"+u))}if(!ft[m])for(h=0,l=at.length;h<l;h++){var L=at[h];if(-1!==u.indexOf(L)){var C=encodeURIComponent(L);C===L&&(C=escape(L)),u=u.split(L).join(C)}}var P=u.indexOf("#");-1!==P&&(e.hash=u.substr(P),u=u.slice(0,P));var U=u.indexOf("?");if(-1!==U?(e.search=u.substr(U),e.query=u.substr(U+1),n&&(e.query=V(e.query)),u=u.slice(0,U)):n&&(e.search="",e.query={}),u&&(e.pathname=u),pt[m]&&e.hostname&&!e.pathname&&(e.pathname="/"),e.pathname||e.search){p=e.pathname||"";var T=e.search||"";e.path=p+T}return e.href=vt(e),e}function vt(e){var r=e.auth||"";r&&(r=(r=encodeURIComponent(r)).replace(/%3A/i,":"),r+="@");var n,o,a,i,s=e.protocol||"",u=e.pathname||"",c=e.hash||"",h=!1,f="";e.host?h=r+e.host:e.hostname&&(h=r+(-1===e.hostname.indexOf(":")?e.hostname:"["+this.hostname+"]"),e.port&&(h+=":"+e.port)),e.query&&K(e.query)&&Object.keys(e.query).length&&(n=e.query,o=o||"&",a=a||"=",null===n&&(n=void 0),f="object"===t(n)?J(Q(n),function(t){var e=encodeURIComponent(Z(t))+a;return Y(n[t])?J(n[t],function(t){return e+encodeURIComponent(Z(t))}).join(o):e+encodeURIComponent(Z(n[t]))}).join(o):i?encodeURIComponent(Z(i))+a+encodeURIComponent(Z(n)):"");var l=e.search||f&&"?"+f||"";return s&&":"!==s.substr(-1)&&(s+=":"),e.slashes||(!s||pt[s])&&!1!==h?(h="//"+(h||""),u&&"/"!==u.charAt(0)&&(u="/"+u)):h||(h=""),c&&"#"!==c.charAt(0)&&(c="#"+c),l&&"?"!==l.charAt(0)&&(l="?"+l),s+h+(u=u.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(l=l.replace("#","%23"))+c}function dt(t){var e=t.host,r=rt.exec(e);r&&(":"!==(r=r[0])&&(t.port=r.substr(1)),e=e.substr(0,e.length-r.length)),e&&(t.hostname=e)}tt.prototype.parse=function(t,e,r){return mt(this,t,e,r)},tt.prototype.format=function(){return vt(this)},tt.prototype.resolve=function(t){return this.resolveObject(yt(t,!1,!0)).format()},tt.prototype.resolveObject=function(t){if(B(t)){var e=new tt;e.parse(t,!1,!0),t=e}for(var r,n=new tt,o=Object.keys(this),a=0;a<o.length;a++){var i=o[a];n[i]=this[i]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),u=0;u<s.length;u++){var c=s[u];"protocol"!==c&&(n[c]=t[c])}return pt[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!pt[t.protocol]){for(var h=Object.keys(t),f=0;f<h.length;f++){var l=h[f];n[l]=t[l]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||lt[t.protocol])n.pathname=t.pathname;else{for(r=(t.pathname||"").split("/");r.length&&!(t.host=r.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==r[0]&&r.unshift(""),r.length<2&&r.unshift(""),n.pathname=r.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var p=n.pathname||"",y=n.search||"";n.path=p+y}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var m,v=n.pathname&&"/"===n.pathname.charAt(0),d=t.host||t.pathname&&"/"===t.pathname.charAt(0),b=d||v||n.host&&t.pathname,g=b,w=n.pathname&&n.pathname.split("/")||[],x=n.protocol&&!pt[n.protocol];if(r=t.pathname&&t.pathname.split("/")||[],x&&(n.hostname="",n.port=null,n.host&&(""===w[0]?w[0]=n.host:w.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===r[0]?r[0]=t.host:r.unshift(t.host)),t.host=null),b=b&&(""===r[0]||""===w[0])),d)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,w=r;else if(r.length)w||(w=[]),w.pop(),w=w.concat(r),n.search=t.search,n.query=t.query;else if(null!=t.search)return x&&(n.hostname=n.host=w.shift(),(m=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=m.shift(),n.host=n.hostname=m.shift())),n.search=t.search,n.query=t.query,$(n.pathname)&&$(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!w.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var j=w.slice(-1)[0],O=(n.host||t.host||w.length>1)&&("."===j||".."===j)||""===j,_=0,E=w.length;E>=0;E--)"."===(j=w[E])?w.splice(E,1):".."===j?(w.splice(E,1),_++):_&&(w.splice(E,1),_--);if(!b&&!g)for(;_--;_)w.unshift("..");!b||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),O&&"/"!==w.join("/").substr(-1)&&w.push("");var k=""===w[0]||w[0]&&"/"===w[0].charAt(0);return x&&(n.hostname=n.host=k?"":w.length?w.shift():"",(m=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=m.shift(),n.host=n.hostname=m.shift())),(b=b||n.host&&w.length)&&!k&&w.unshift(""),w.length?n.pathname=w.join("/"):(n.pathname=null,n.path=null),$(n.pathname)&&$(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},tt.prototype.parseHost=function(){return dt(this)};var bt=v.window?window.URL:X.URL,gt=/^https?:\/\//i,wt=function(t){return"undefined"!=typeof self&&self&&t in self?self[t]:"undefined"!=typeof window&&window&&t in window?window[t]:"undefined"!=typeof global&&global&&t in global?global[t]:"undefined"!=typeof globalThis&&globalThis?globalThis[t]:void 0},xt=wt("document"),jt=wt("Headers"),Ot=wt("Response"),_t=wt("fetch"),Et=wt("AbortController"),kt=function(e){return null!==e&&"object"===t(e)},Rt="function"==typeof wt("AbortController"),At=function t(){for(var e={},r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];for(var s=0;s<n.length;s++){var u=n[s];if(Array.isArray(u))Array.isArray(e)||(e=[]),e=[].concat(m(e),m(u));else if(kt(u))for(var c=Object.entries(u),h=0;h<c.length;h++){var f=y(c[h],2),l=f[0],p=f[1];kt(p)&&Reflect.has(e,l)&&(p=t(e[l],p)),e=i({},e,a({},l,p))}}return e},St=["get","post","put","patch","head","delete"],Lt=["json","text","formData","arrayBuffer","blob"],Ct=new Set(["get","put","head","delete","options","trace"]),Pt=new Set([408,413,429,500,502,503,504]),Ut=new Set([413,429,503]),Tt=function(t){function e(t){var r;return n(this,e),(r=p(this,u(e).call(this,t.statusText))).name="HTTPError",r.response=t,r}return s(e,f(Error)),e}(),It=function(t){function e(){var t;return n(this,e),(t=p(this,u(e).call(this,"Request timed out"))).name="TimeoutError",t}return s(e,f(Error)),e}(),qt=function(t){return new Promise(function(e){return setTimeout(e,t)})},Nt=function(t,e,n){return Promise.race([t,r(O.mark(function t(){return O.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,qt(e);case 2:throw n&&setTimeout(function(){return n.abort()},1),new It;case 4:case"end":return t.stop()}},t)}))()])},Ft=function(t){return St.includes(t)?t.toUpperCase():t},Dt=function(){function t(e,o){var a=this,s=o.timeout,u=void 0===s?1e4:s,c=o.hooks,h=o.throwHttpErrors,f=void 0===h||h,p=o.searchParams,y=o.json,m=l(o,["timeout","hooks","throwHttpErrors","searchParams","json"]);if(n(this,t),this._retryCount=0,this._options=i({method:"get",credentials:"same-origin",retry:2},m),Rt&&(this.abortController=new Et,this._options.signal&&this._options.signal.addEventListener("abort",function(){a.abortController.abort()}),this._options.signal=this.abortController.signal),this._options.method=Ft(this._options.method),this._options.prefixUrl=String(this._options.prefixUrl||""),this._input=String(e||""),this._options.prefixUrl&&this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");if(this._options.prefixUrl&&!this._options.prefixUrl.endsWith("/")&&(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input,p){var v=new URL(this._input,xt&&xt.baseURI);if("string"==typeof p||URLSearchParams&&p instanceof URLSearchParams)v.search=p;else{if(!Object.values(p).every(function(t){return"number"==typeof t||"string"==typeof t}))throw new Error("The `searchParams` option must be either a string, `URLSearchParams` instance or an object with string and number values");v.search=new URLSearchParams(p).toString()}this._input=v.toString()}this._timeout=u,this._hooks=At({beforeRequest:[],afterResponse:[]},c),this._throwHttpErrors=f;var d=new jt(this._options.headers||{});if(y){if(this._options.body)throw new Error("The `json` option cannot be used with the `body` option");d.set("content-type","application/json"),this._options.body=JSON.stringify(y)}this._options.headers=d;for(var b=function(){var t=r(O.mark(function t(){var e,r,n,o,i,s,u,c;return O.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a._fetch();case 2:e=t.sent,r=!0,n=!1,o=void 0,t.prev=6,i=a._hooks.afterResponse[Symbol.iterator]();case 8:if(r=(s=i.next()).done){t.next=17;break}return u=s.value,t.next=12,u(e.clone());case 12:(c=t.sent)instanceof Ot&&(e=c);case 14:r=!0,t.next=8;break;case 17:t.next=23;break;case 19:t.prev=19,t.t0=t.catch(6),n=!0,o=t.t0;case 23:t.prev=23,t.prev=24,r||null==i.return||i.return();case 26:if(t.prev=26,!n){t.next=29;break}throw o;case 29:return t.finish(26);case 30:return t.finish(23);case 31:if(e.ok||!a._throwHttpErrors){t.next=33;break}throw new Tt(e);case 33:return t.abrupt("return",e);case 34:case"end":return t.stop()}},t,null,[[6,19,23,31],[24,,26,30]])}));return function(){return t.apply(this,arguments)}}(),g=Ct.has(this._options.method.toLowerCase())?this._retry(b):b(),w=function(){var t=Lt[x];g[t]=r(O.mark(function e(){return O.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g;case 2:return e.t0=t,e.abrupt("return",e.sent.clone()[e.t0]());case 4:case"end":return e.stop()}},e)}))},x=0;x<Lt.length;x++)w();return g}var e,a,s;return e=t,(a=[{key:"_calculateRetryDelay",value:function(t){if(this._retryCount++,this._retryCount<this._options.retry&&!(t instanceof It)){if(t instanceof Tt){if(!Pt.has(t.response.status))return 0;var e=t.response.headers.get("Retry-After");if(e&&Ut.has(t.response.status)){var r=Number(e);return Number.isNaN(r)?r=Date.parse(e)-Date.now():r*=1e3,r}if(413===t.response.status)return 0}return.3*Math.pow(2,this._retryCount-1)*1e3}return 0}},{key:"_retry",value:function(){var t=r(O.mark(function t(e){var r;return O.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:return t.abrupt("return",t.sent);case 6:if(t.prev=6,t.t0=t.catch(0),!(0!==(r=this._calculateRetryDelay(t.t0))&&this._retryCount>0)){t.next=13;break}return t.next=12,qt(r);case 12:return t.abrupt("return",this._retry(e));case 13:if(!this._throwHttpErrors){t.next=15;break}throw t.t0;case 15:case"end":return t.stop()}},t,this,[[0,6]])}));return function(e){return t.apply(this,arguments)}}()},{key:"_fetch",value:function(){var t=r(O.mark(function t(){var e,r,n,o,a,i;return O.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=!0,r=!1,n=void 0,t.prev=3,o=this._hooks.beforeRequest[Symbol.iterator]();case 5:if(e=(a=o.next()).done){t.next=12;break}return i=a.value,t.next=9,i(this._options);case 9:e=!0,t.next=5;break;case 12:t.next=18;break;case 14:t.prev=14,t.t0=t.catch(3),r=!0,n=t.t0;case 18:t.prev=18,t.prev=19,e||null==o.return||o.return();case 21:if(t.prev=21,!r){t.next=24;break}throw n;case 24:return t.finish(21);case 25:return t.finish(18);case 26:return t.abrupt("return",Nt(_t(this._input,this._options),this._timeout,this.abortController));case 27:case"end":return t.stop()}},t,this,[[3,14,18,26],[19,,21,25]])}));return function(){return t.apply(this,arguments)}}()}])&&o(e.prototype,a),s&&o(e,s),t}(),Ht=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!kt(e)||Array.isArray(e))throw new TypeError("The `defaultOptions` argument must be an object");for(var r=function(t,r){return new Dt(t,At({},e,r))},n=function(){var t=St[o];r[t]=function(r,n){return new Dt(r,At({},e,n,{method:t}))}},o=0;o<St.length;o++)n();return r.extend=function(e){return t(e)},r}(),Gt=function(t){return null!=t&&null!=t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},Mt=zt;function zt(t,e){var r=(e=e||{}).delimiter||".",n=e.maxDepth,o={};return function t(a,i,s){s=s||1,Object.keys(a).forEach(function(u){var c=a[u],h=e.safe&&Array.isArray(c),f=Object.prototype.toString.call(c),l=Gt(c),p=i?i+r+u:u;if(!h&&!l&&("[object Object]"===f||"[object Array]"===f)&&Object.keys(c).length&&(!e.maxDepth||s<n))return t(c,p,s+1);o[p]=c})}(t),o}return zt.flatten=zt,zt.unflatten=function t(e,r){r=r||{};var n=r.delimiter||".";var o=r.overwrite||!1;var a={};var i=Gt(e);if(i||"[object Object]"!==Object.prototype.toString.call(e))return e;function s(t){var e=Number(t);return isNaN(e)||-1!==t.indexOf(".")||r.object?t:e}var u=Object.keys(e).sort(function(t,e){return t.length-e.length});u.forEach(function(i){for(var u=i.split(n),c=s(u.shift()),h=s(u[0]),f=a;void 0!==h;){var l=Object.prototype.toString.call(f[c]),p="[object Object]"===l||"[object Array]"===l;if(!o&&!p&&void 0!==f[c])return;(o&&!p||!o&&null==f[c])&&(f[c]="number"!=typeof h||r.object?{}:[]),f=f[c],u.length>0&&(c=s(u.shift()),h=s(u[0]))}f[c]=t(e[i],r)});return a},require("./factory")({MicrolinkError:require("whoops")("MicrolinkError"),isUrlHttp:function(t){try{return new bt(t)&&gt.test(t)}catch(t){return!1}},stringify:function(t,e){var r,n,o,a="";for(r in t)if(void 0!==(o=t[r]))if(Array.isArray(o))for(n=0;n<o.length;n++)a&&(a+="&"),a+=encodeURIComponent(r)+"="+encodeURIComponent(o[n]);else a&&(a+="&"),a+=encodeURIComponent(r)+"="+encodeURIComponent(o);return(e||"")+a},got:function(){var t=r(O.mark(function t(e,r){var n,o,a,i,s,u;return O.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r.json,r.headers,r.cache,n=l(r,["json","headers","cache"]),t.prev=1,t.next=4,Ht(e,n);case 4:return o=t.sent,t.next=7,o.json();case 7:return a=t.sent,i=o.headers,s=o.status,u=o.statusText,t.abrupt("return",{url:o.url,body:a,headers:i,statusCode:s,statusMessage:u});case 12:if(t.prev=12,t.t0=t.catch(1),!t.t0.response){t.next=20;break}return t.next=17,t.t0.response.json();case 17:t.t1=t.sent,t.next=21;break;case 20:t.t1="";case 21:throw t.t0.body=t.t1,t.t0.statusCode=t.t0.response.status,t.t0.headers=t.t0.response.headers,t.t0;case 25:case"end":return t.stop()}},t,null,[[1,12]])}));return function(e,r){return t.apply(this,arguments)}}(),flatten:Mt})});
