!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("url")):"function"==typeof define&&define.amd?define(["url"],e):(t=t||self).mql=e(t.url)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e=Object.freeze({default:t=>t});const r=(t,e)=>{for(const r of Reflect.ownKeys(e))Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r));return t};var o=r,n=r;o.default=n;var s={isFunction:t=>"function"==typeof t,isString:t=>"string"==typeof t,composeErrorMessage:(t,e)=>`${t}, ${e}`,inherits:(t,e)=>{t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}};const{isFunction:i,composeErrorMessage:a}=s;var c=function(t,...e){Object.assign(t,...e),t.description=i(t.message)?t.message(t):t.message,t.message=t.code?a(t.code,t.description):t.description},u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var f,h=(f=e)&&f.default||f;const{isString:p}=s;var l=function(t,e){function r(r){const o=new t,n=p(r)?{message:r}:r;return c(o,e,n),o.stack=h(o.stack),o}return r.prototype=t.prototype,o(r,t),r};const{inherits:d}=s,y=/[^0-9a-zA-Z_$]/;var b=function(t){if("string"!=typeof t)throw new TypeError("Expected className to be a string");if(y.test(t))throw new Error("className contains invalid characters");function e(){Object.defineProperty(this,"name",{configurable:!0,value:t,writable:!0}),Error.captureStackTrace(this,this.constructor)}return d(e,Error),o(e,Error),e};const w=t=>(e,r)=>{const o=b(e||t.name);return l(o,r)};var m=w(Error),g=w(TypeError),_=w(RangeError),E=w(EvalError),v=w(SyntaxError),j=w(ReferenceError),R=w(URIError);function O(t){if(!t)return"";var e=decodeURIComponent(t);return"false"!==e&&("true"===e||(0*+e==0?+e:e))}m.type=g,m.range=_,m.eval=E,m.syntax=v,m.reference=j,m.uri=R;var U=Object.freeze({encode:function(t,e){var r,o,n,s="";for(r in t)if(void 0!==(n=t[r]))if(Array.isArray(n))for(o=0;o<n.length;o++)s&&(s+="&"),s+=encodeURIComponent(r)+"="+encodeURIComponent(n[o]);else s&&(s+="&"),s+=encodeURIComponent(r)+"="+encodeURIComponent(n);return(e||"")+s},decode:function(t){for(var e,r,o={},n=t.split("&");e=n.shift();)void 0!==o[r=(e=e.split("=")).shift()]?o[r]=[].concat(o[r],O(e.shift())):o[r]=O(e.shift());return o}});const x=u.window?window.URL:t.URL,A=/^https?:\/\//i;var C,T,S=(function(t,e){!function(t){const e=t=>"undefined"!=typeof self&&self&&t in self?self[t]:"undefined"!=typeof window&&window&&t in window?window[t]:void 0!==u&&u&&t in u?u[t]:"undefined"!=typeof globalThis&&globalThis?globalThis[t]:void 0,r=e("document"),o=e("Headers"),n=e("Response"),s=e("fetch"),i=e("AbortController"),a=t=>null!==t&&"object"==typeof t,c="function"==typeof e("AbortController"),f=(...t)=>{let e={};for(const r of t)if(Array.isArray(r))Array.isArray(e)||(e=[]),e=[...e,...r];else if(a(r))for(let[t,o]of Object.entries(r))a(o)&&Reflect.has(e,t)&&(o=f(e[t],o)),e={...e,[t]:o};return e},h=["get","post","put","patch","head","delete"],p={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},l=new Set(["get","put","head","delete","options","trace"]),d=new Set([408,413,429,500,502,503,504]),y=new Set([413,429,503]);class b extends Error{constructor(t){super(t.statusText),this.name="HTTPError",this.response=t}}class w extends Error{constructor(){super("Request timed out"),this.name="TimeoutError"}}const m=t=>new Promise(e=>setTimeout(e,t)),g=(t,e,r)=>new Promise((o,n)=>{t.then(o).catch(n),m(e).then(()=>{c&&r.abort(),n(new w)})}),_=t=>h.includes(t)?t.toUpperCase():t;class E{constructor(t,{timeout:e=1e4,hooks:s,throwHttpErrors:a=!0,searchParams:u,json:h,...d}){if(this._retryCount=0,this._options={method:"get",credentials:"same-origin",retry:2,...d},c&&(this.abortController=new i,this._options.signal&&this._options.signal.addEventListener("abort",()=>{this.abortController.abort()}),this._options.signal=this.abortController.signal),this._options.method=_(this._options.method),this._options.prefixUrl=String(this._options.prefixUrl||""),this._input=String(t||""),this._options.prefixUrl&&this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");if(this._options.prefixUrl&&!this._options.prefixUrl.endsWith("/")&&(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input,u){const t=new URL(this._input,r&&r.baseURI);if("string"==typeof u||URLSearchParams&&u instanceof URLSearchParams)t.search=u;else{if(!Object.values(u).every(t=>"number"==typeof t||"string"==typeof t))throw new Error("The `searchParams` option must be either a string, `URLSearchParams` instance or an object with string and number values");t.search=new URLSearchParams(u).toString()}this._input=t.toString()}this._timeout=e,this._hooks=f({beforeRequest:[],afterResponse:[]},s),this._throwHttpErrors=a;const y=new o(this._options.headers||{});if(h){if(this._options.body)throw new Error("The `json` option cannot be used with the `body` option");y.set("content-type","application/json"),this._options.body=JSON.stringify(h)}this._options.headers=y;const w=async()=>{await m(1);let t=await this._fetch();for(const e of this._hooks.afterResponse){const r=await e(t.clone());r instanceof n&&(t=r)}if(!t.ok&&this._throwHttpErrors)throw new b(t);return t},g=l.has(this._options.method.toLowerCase()),E=g?this._retry(w):w();for(const[t,e]of Object.entries(p))E[t]=(async()=>(y.set("accept",e),(await E).clone()[t]()));return E}_calculateRetryDelay(t){if(this._retryCount++,this._retryCount<this._options.retry&&!(t instanceof w)){if(t instanceof b){if(!d.has(t.response.status))return 0;const e=t.response.headers.get("Retry-After");if(e&&y.has(t.response.status)){let t=Number(e);return Number.isNaN(t)?t=Date.parse(e)-Date.now():t*=1e3,t}if(413===t.response.status)return 0}const e=.3;return e*2**(this._retryCount-1)*1e3}return 0}async _retry(t){try{return await t()}catch(e){const r=this._calculateRetryDelay(e);if(0!==r&&this._retryCount>0)return await m(r),this._retry(t);if(this._throwHttpErrors)throw e}}async _fetch(){for(const t of this._hooks.beforeRequest)await t(this._options);return g(s(this._input,this._options),this._timeout,this.abortController)}}const v=(t={})=>{if(!a(t)||Array.isArray(t))throw new TypeError("The `defaultOptions` argument must be an object");const e=(e,r)=>new E(e,f({},t,r));for(const r of h)e[r]=((e,o)=>new E(e,f({},t,o,{method:r})));return e.extend=(t=>v(t)),e};var j=v();t.HTTPError=b,t.TimeoutError=w,t.default=j,Object.defineProperty(t,"__esModule",{value:!0})}(e)}(C={exports:{}},C.exports),C.exports);(T=S)&&T.__esModule&&Object.prototype.hasOwnProperty.call(T,"default")&&T.default;var k=S.default,L=function(t){return null!=t&&null!=t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},P=I;function I(t,e){var r=(e=e||{}).delimiter||".",o=e.maxDepth,n={};return function t(s,i,a){a=a||1,Object.keys(s).forEach(function(c){var u=s[c],f=e.safe&&Array.isArray(u),h=Object.prototype.toString.call(u),p=L(u),l=i?i+r+c:c;if(!f&&!p&&("[object Object]"===h||"[object Array]"===h)&&Object.keys(u).length&&(!e.maxDepth||a<o))return t(u,l,a+1);n[l]=u})}(t),n}I.flatten=I,I.unflatten=function t(e,r){r=r||{};var o=r.delimiter||".";var n=r.overwrite||!1;var s={};var i=L(e);if(i||"[object Object]"!==Object.prototype.toString.call(e))return e;function a(t){var e=Number(t);return isNaN(e)||-1!==t.indexOf(".")||r.object?t:e}var c=Object.keys(e).sort(function(t,e){return t.length-e.length});c.forEach(function(i){for(var c=i.split(o),u=a(c.shift()),f=a(c[0]),h=s;void 0!==f;){var p=Object.prototype.toString.call(h[u]),l="[object Object]"===p||"[object Array]"===p;if(!n&&!l&&void 0!==h[u])return;(n&&!l||!n&&null==h[u])&&(h[u]="number"!=typeof f||r.object?{}:[]),h=h[u],c.length>0&&(u=a(c.shift()),f=a(c[0]))}h[u]=t(e[i],r)});return s};const N={FREE:"https://api.microlink.io",PRO:"https://pro.microlink.io"},D={INVALID_URL:"ENOVALIDURL",FAILED:"EFAILED"};var H=function({VERSION:t,MicrolinkError:e,isUrlHttp:r,stringify:o,got:n,flatten:s}){const i=(t={})=>{const e=s(t);return Object.keys(e).reduce((t,r)=>({...t,[`data.${r}`]:e[r]}),{})},a=(t,{rules:e,apiKey:r,...n}={})=>{const s=!!r;return[`${N[s?"PRO":"FREE"]}?${o({url:t,...i(e),...n})}`,{headers:s?{"x-api-key":r}:{}}]},c=async(t,{cache:o=null,retry:s=3,timeout:i=25e3,...c}={})=>{((t="")=>{if(!r(t))throw new e({code:D.INVALID_URL,message:`The URL \`${t}\` is not valid. Ensure it has protocol (http or https) and hostname.`})})(t);const[u,{headers:f}]=a(t,c);return(async(t,r)=>{try{const o=await n(t,r),{body:s}=o;return{...s,response:o}}catch(t){const r=t.statusCode||500,o=t.body?t.body.message:t.message,n=t.body?t.body.status:"fail";throw e({...t,status:n,message:o,statusCode:r,code:D.FAILED})}})(u,{cache:o,retry:s,timeout:i,headers:f,json:!0})};return c.MicrolinkError=e,c.apiUrl=a,c.mapRules=i,c.version=t,c};const M=m("MicrolinkError"),{encode:F}=U;return H({MicrolinkError:M,isUrlHttp:t=>{try{return new x(t)&&A.test(t)}catch(t){return!1}},stringify:F,got:async(t,{json:e,headers:r,cache:o,...n})=>{try{const e=await k(t,n),r=await e.json(),{headers:o,status:s,statusText:i}=e;return{url:e.url,body:r,headers:o,statusCode:s,statusMessage:i}}catch(t){throw t.body=t.response?await t.response.json():"",t.statusCode=t.response.status,t.headers=t.response.headers,t}},flatten:P,VERSION:"0.3.4"})});
